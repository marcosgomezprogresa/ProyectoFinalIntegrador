<div class="w-100">
  <!-- Toolbar Filtros -->
  <div class="bg-light border-bottom shadow-sm mb-4">
    <div class="container-fluid py-3">
      <div class="row align-items-center g-3">
        <div class="col-auto">
          <label class="form-label mb-0 fw-bold">ğŸ“‚ CategorÃ­a:</label>
        </div>
        <div class="col-auto">
          <select class="form-select form-select-sm" [(ngModel)]="categoriaSeleccionada">
            <option value="">Todas</option>
            <option value="entrante">Entrante</option>
            <option value="principal">Principal</option>
            <option value="postre">Postre</option>
            <option value="bebida">Bebida</option>
            <option value="refrigerio">Refrigerio</option>
          </select>
        </div>
        <div class="col-auto">
          <button class="btn btn-sm btn-outline-primary" (click)="alCambiarCategoria()">ğŸ” Buscar</button>
        </div>
        <div class="col-auto">
          <button class="btn btn-sm btn-outline-success" (click)="obtenerRecetasVeganas()">ğŸŒ± Veganas</button>
        </div>
        <div class="col-auto">
          <button class="btn btn-sm btn-outline-info" (click)="cargarRecetas()">âœ… Todas</button>
        </div>
        <div class="col-auto ms-auto">
          <button class="btn btn-sm btn-primary" (click)="abrirFormularioModal()">â• Nueva Receta</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Alerts -->
  <div class="container-fluid">
    <div *ngIf="cargando" class="text-center py-4">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>
    <div *ngIf="mensajeError" class="alert alert-danger alert-dismissible fade show" role="alert">
      {{ mensajeError }}
      <button type="button" class="btn-close" (click)="mensajeError = null"></button>
    </div>
    <div *ngIf="mensajeExito" class="alert alert-success alert-dismissible fade show" role="alert">
      {{ mensajeExito }}
      <button type="button" class="btn-close" (click)="mensajeExito = null"></button>
    </div>
  </div>

  <!-- Cards Grid -->
  <div class="container-fluid" id="recipes-section">
    <div class="mb-5">
      <h3 class="mb-4 fw-bold">ğŸ“‹ Recetas ({{paginacion.total}} total)</h3>

      <ng-container *ngIf="recetas.length > 0">
        <div class="row g-4">
          <div *ngFor="let receta of recetas" class="col-lg-3 col-md-6">
            <div class="card h-100 shadow-sm border-0 recipe-card">
              <div class="card-image" style="height:150px; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); display:flex; align-items:center; justify-content:center; overflow:hidden;">
                <img *ngIf="receta.imageUrl" [src]="receta.imageUrl" [alt]="receta.title" style="width:100%; height:100%; object-fit:cover;">
                <div *ngIf="!receta.imageUrl" style="font-size:2.5rem;">ğŸ³</div>
              </div>
              <div class="card-body d-flex flex-column">
                <div class="mb-2">
                  <span class="badge me-1" [ngClass]="obtenerClaseBadgeCategoria(receta.category)">{{ obtenerEtiquetaCategoria(receta.category) }}</span>
                  <span class="badge me-1" [ngClass]="obtenerClaseBadgeDificultad(receta.difficulty)">{{ obtenerEtiquetaDificultad(receta.difficulty) }}</span>
                  <span *ngIf="receta.isVegan" class="badge bg-success me-1">ğŸŒ± Vegana</span>
                  <span *ngIf="receta.isGlutenFree" class="badge bg-info">ğŸš« Sin Gluten</span>
                </div>
                <h5 class="card-title fw-bold mb-2" style="min-height:2em; font-size:1rem;">{{ receta.title }}</h5>
                <p class="card-text text-muted small flex-grow-1">{{ receta.description | slice:0:70 }}...</p>
                <div class="d-flex justify-content-between text-muted small mb-3 py-2 border-top border-bottom">
                  <span>â±ï¸ {{ receta.preparationTime }}m</span>
                  <span>ğŸ‘¥ {{ receta.servings }}</span>
                  <span>â­ {{ receta.rating }}/5</span>
                </div>
                <div class="d-grid gap-2">
                  <button class="btn btn-sm btn-primary" (click)="verReceta(receta)">ğŸ‘ï¸ Ver</button>
                  <button class="btn btn-sm btn-warning" (click)="editarReceta(receta)">âœï¸ Editar</button>
                  <button class="btn btn-sm btn-danger" (click)="eliminarReceta(receta._id!)">ğŸ—‘ï¸ Eliminar</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <nav class="d-flex justify-content-center mt-5">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="paginacion.page <= 1">
              <button class="page-link" (click)="irAPagina(paginacion.page - 1)" [disabled]="paginacion.page <= 1">â† Anterior</button>
            </li>
            <li class="page-item active">
              <span class="page-link">{{ paginacion.page }}/{{ paginacion.pages }}</span>
            </li>
            <li class="page-item" [class.disabled]="paginacion.page >= paginacion.pages">
              <button class="page-link" (click)="irAPagina(paginacion.page + 1)" [disabled]="paginacion.page >= paginacion.pages">Siguiente â†’</button>
            </li>
          </ul>
        </nav>
      </ng-container>

      <ng-container *ngIf="recetas.length === 0 && !cargando">
        <div class="alert alert-info text-center">
          <p class="mb-0">No hay recetas disponibles</p>
        </div>
      </ng-container>
    </div>
  </div>
</div>

<!-- Modal Detalle -->
<div class="modal fade" id="detalleModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Detalles de Receta</h5>
        <button type="button" class="btn-close" (click)="cerrarDetalleModal()"></button>
      </div>
      <div class="modal-body">
        <app-detalle-receta *ngIf="recetaSeleccionada" [receta]="recetaSeleccionada"></app-detalle-receta>
      </div>
    </div>
  </div>
</div>

<!-- Modal Formulario -->
<div class="modal fade" id="formularioModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">{{ recetaEditando ? 'Editar Receta' : 'Nueva Receta' }}</h5>
        <button type="button" class="btn-close" (click)="cerrarFormularioModal()"></button>
      </div>
      <div class="modal-body">
        <app-formulario-receta 
          [receta]="recetaEditando" 
          (guardada)="alRecetaGuardada($event)"
          (cerrada)="cerrarFormularioModal()">
        </app-formulario-receta>
      </div>
    </div>
  </div>
</div>
